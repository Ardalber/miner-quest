<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Miner Quest</title>
    <link rel="stylesheet" href="css/game.css">
</head>
<body>
    <!-- Modal de prÃ©nom au dÃ©marrage -->
    <div id="modal-name" class="modal" style="display: flex;">
        <div class="modal-content modal-name-content">
            <h2>ğŸ® Bienvenue dans Miner Quest!</h2>
            <p style="margin-bottom: 20px; color: #666;">Entrez votre prÃ©nom pour commencer l'aventure</p>
            <input type="text" id="player-name-input" placeholder="Votre prÃ©nom" maxlength="20" style="width: 100%; padding: 12px; font-size: 16px; border: 2px solid #667eea; border-radius: 8px; margin-bottom: 20px; text-align: center;">
            <button id="btn-start-game" class="btn-primary">â–¶ï¸ Commencer</button>
        </div>
    </div>

    <!-- Conteneur des notifications -->
    <div id="toast-container" class="toast-container"></div>
    
    <div class="game-container">
        <div class="game-wrapper">
            <button id="btn-commands" class="btn-top-left">ğŸ® Commandes</button>
            <div id="test-badge" class="test-badge" style="display: none;">ğŸ§ª TEST</div>
            <div id="level-display" class="level-display">Level 1</div>
            <button id="btn-inventory" class="btn-top-center">ğŸ’ Inventaire</button>
            <button id="btn-tiles" class="btn-top-right-2">ğŸ¨ Tuiles</button>
            <button id="btn-editor" class="btn-top-right">âœï¸ Ã‰diteur</button>
            <canvas id="gameCanvas" width="512" height="512"></canvas>
        </div>
    </div>

    <!-- Modal des commandes -->
    <div id="modal-commands" class="modal">
        <div class="modal-content">
            <h2>ğŸ® Commandes</h2>
            <div class="control-item">
                <span>Se dÃ©placer vers le haut</span>
                <span class="control-key">Z</span>
            </div>
            <div class="control-item">
                <span>Se dÃ©placer vers le bas</span>
                <span class="control-key">S</span>
            </div>
            <div class="control-item">
                <span>Se dÃ©placer vers la gauche</span>
                <span class="control-key">Q</span>
            </div>
            <div class="control-item">
                <span>Se dÃ©placer vers la droite</span>
                <span class="control-key">D</span>
            </div>
            <div class="control-item">
                <span>Miner un bloc</span>
                <span class="control-key">ESPACE</span>
            </div>
            <button id="btn-close-modal" class="modal-close-btn">Fermer</button>
        </div>
    </div>

    <!-- Modal de l'inventaire -->
    <div id="modal-inventory" class="modal">
        <div class="modal-content">
            <h2>ğŸ’ Inventaire</h2>
            <div class="inventory-grid">
                <div class="inventory-item">
                    <div class="item-icon" style="background: #7a7a7a;">ğŸª¨</div>
                    <div class="item-info">
                        <span class="item-name">Pierre</span>
                        <span class="item-count" id="inv-stone-count">0</span>
                    </div>
                </div>
                <div class="inventory-item">
                    <div class="item-icon" style="background: #b87333;">âš™ï¸</div>
                    <div class="item-info">
                        <span class="item-name">Fer</span>
                        <span class="item-count" id="inv-iron-count">0</span>
                    </div>
                </div>
                <div class="inventory-item">
                    <div class="item-icon" style="background: #ffd700;">â­</div>
                    <div class="item-info">
                        <span class="item-name">Or</span>
                        <span class="item-count" id="inv-gold-count">0</span>
                    </div>
                </div>
            </div>
            <button id="btn-close-inventory" class="modal-close-btn">Fermer</button>
        </div>
    </div>

    <!-- Modal du coffre -->
    <div id="modal-chest" class="modal">
        <div class="modal-content modal-chest-content">
            <div class="chest-container">
                <div class="chest-section">
                    <h2>ğŸ’ Votre inventaire</h2>
                    <div id="player-inventory-display" class="inventory-grid">
                        <div class="inventory-item">
                            <div class="item-icon" style="background: #7a7a7a;">ğŸª¨</div>
                            <div class="item-info">
                                <span class="item-name">Pierre</span>
                                <span class="item-count" id="player-stone-count">0</span>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <div class="item-icon" style="background: #b87333;">âš™ï¸</div>
                            <div class="item-info">
                                <span class="item-name">Fer</span>
                                <span class="item-count" id="player-iron-count">0</span>
                            </div>
                        </div>
                        <div class="inventory-item">
                            <div class="item-icon" style="background: #ffd700;">â­</div>
                            <div class="item-info">
                                <span class="item-name">Or</span>
                                <span class="item-count" id="player-gold-count">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chest-section">
                    <div class="chest-header">
                        <h2>ğŸ“¦ Contenu du coffre</h2>
                        <button id="btn-take-all-chest" class="btn-secondary" title="Prendre toutes les ressources">ğŸƒ Prendre tout</button>
                    </div>
                    <div id="chest-grid" class="chest-grid"></div>
                </div>
            </div>
            <button id="btn-close-chest" class="modal-close-btn">Fermer</button>
        </div>
    </div>

    <!-- Modal d'Ã©dition des coffres (pour l'Ã©diteur) -->
    <div id="modal-chest-editor" class="modal">
        <div class="modal-content modal-chest-editor-content">
            <h2>ğŸ“¦ Ã‰diter le contenu du coffre</h2>
            
            <div class="chest-editor-container">
                <div class="chest-add-resource">
                    <h3>â• Ajouter une ressource</h3>
                    
                    <div class="form-group">
                        <label for="chest-resource-select">Ressource mineable:</label>
                        <select id="chest-resource-select">
                            <option value="">-- SÃ©lectionner une ressource --</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="chest-resource-quantity">QuantitÃ©:</label>
                        <input type="number" id="chest-resource-quantity" min="1" max="999" value="1">
                    </div>
                    
                    <button id="btn-add-to-chest" class="btn-success">â• Ajouter</button>
                </div>
                
                <div class="chest-contents">
                    <h3>ğŸ“‹ Contenu du coffre</h3>
                    <div id="chest-editor-contents" class="chest-editor-contents-list">
                        <!-- Items seront ajoutÃ©s dynamiquement -->
                    </div>
                </div>
            </div>
            
            <button id="btn-close-chest-editor" class="modal-close-btn">Fermer</button>
        </div>
    </div>

    <!-- Modal du panneau (lecture seule) -->
    <div id="modal-sign" class="modal">
        <div class="modal-content modal-sign-content">
            <h2>ğŸ“‹ Panneau</h2>
            <div id="sign-content" class="sign-message" style="
                background: #ffffff;
                border: 2px solid #667eea;
                border-radius: 8px;
                padding: 20px;
                margin: 20px 0;
                min-height: 100px;
                display: flex;
                align-items: center;
                justify-content: center;
                color: #000000;
                font-size: 16px;
                white-space: pre-wrap;
                word-wrap: break-word;
            "></div>
            <button id="btn-close-sign" class="modal-close-btn">Fermer</button>
        </div>
    </div>

    <!-- INITIALISER TILECONFIG ET TILETYPES EN PREMIER DANS LE HTML -->
    <script>
        // CRÃ‰ER TILETYPES ET TILECONFIG IMMÃ‰DIATEMENT - AVANT TOUT AUTRE SCRIPT
        window.TileTypes = {
            EMPTY: 0,
            EARTH: 1,
            STONE: 2,
            IRON: 3,
            GOLD: 4,
            WALL: 5,
            GRASS: 111,
            CHEST: 10,
            SIGN: 11,
            WARP: 12,
            BARRIER_H: 20,
            BARRIER_V: 21,
            TREE: 30,
            BARRIER_L_NE: 40,
            BARRIER_L_SE: 41,
            BARRIER_L_SW: 42,
            BARRIER_L_NW: 43
        };
        console.log('âœ“ TileTypes dÃ©finis');
        
        if (typeof TileConfig === 'undefined') {
            window.TileConfig = {};
            console.log('âœ“ TileConfig initialisÃ© en inline script');
        }
        
        // Tuile 0: EMPTY
        window.TileConfig[0] = { name: 'Vide', color: 'transparent', minable: false, resource: null };
        
        // Tuile 1: EARTH
        window.TileConfig[1] = { name: 'Terre', color: '#8B4513', minable: true, resource: 'stone', drawFunction: 'drawGrass' };
        
        // Tuile 2: STONE
        window.TileConfig[2] = { name: 'Pierre', color: '#808080', minable: true, resource: 'stone', drawFunction: 'drawStone' };
        
        // Tuile 3: IRON
        window.TileConfig[3] = { name: 'Fer', color: '#8b5a3c', minable: true, resource: 'iron', drawFunction: 'drawIron' };
        
        // Tuile 4: GOLD
        window.TileConfig[4] = { name: 'Or', color: '#daa520', minable: true, resource: 'gold', drawFunction: 'drawGold' };
        
        // Tuile 5: WALL
        window.TileConfig[5] = { name: 'Mur', color: '#2a2a2a', minable: false, resource: null, drawFunction: 'drawWall' };
        
        // Tuile 10: CHEST
        window.TileConfig[10] = { name: 'Coffre', color: '#8b5a2b', minable: false, resource: null, drawFunction: 'drawChest' };
        
        // Tuile 11: SIGN
        window.TileConfig[11] = { name: 'Panneau', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawSign' };
        
        // Tuile 12: WARP
        window.TileConfig[12] = { name: 'Portail', color: '#9370DB', minable: false, resource: null, drawFunction: 'drawWarp' };
        
        // Tuile 20: BARRIER_H
        window.TileConfig[20] = { name: 'BarriÃ¨re H', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierH' };
        
        // Tuile 21: BARRIER_V
        window.TileConfig[21] = { name: 'BarriÃ¨re V', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierV' };
        
        // Tuile 30: TREE
        window.TileConfig[30] = { name: 'Arbre', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawTree' };
        
        // Tuile 40: BARRIER_L_NE
        window.TileConfig[40] = { name: 'BarriÃ¨re L NE', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierL_NE' };
        
        // Tuile 41: BARRIER_L_SE
        window.TileConfig[41] = { name: 'BarriÃ¨re L SE', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierL_SE' };
        
        // Tuile 42: BARRIER_L_SW
        window.TileConfig[42] = { name: 'BarriÃ¨re L SW', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierL_SW' };
        
        // Tuile 43: BARRIER_L_NW
        window.TileConfig[43] = { name: 'BarriÃ¨re L NW', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawBarrierL_NW' };
        
        // Tuile 111: GRASS (LA TUILE LA PLUS IMPORTANTE!)
        window.TileConfig[111] = { name: 'Herbe', color: '#4a9d4e', minable: false, resource: null, drawFunction: 'drawGrass' };
        
        console.log('%câœ“âœ“âœ“ TILECONFIG INITIALIZED IN HTML! Keys: ' + Object.keys(window.TileConfig).filter(k => !isNaN(k)).sort((a,b)=>a-b).join(', '), 'background: green; color: white; font-size: 14px;');
    </script>

    <!-- FORCING NEW DEPLOYMENT: 2026-01-19-20:00 -->
    <script>
        window.DEPLOY_TIME = '2026-01-19-20:00';
        console.log('ğŸš€ DEPLOY_TIME:', window.DEPLOY_TIME);
        console.log('ğŸš€ PAGE LOADED AT:', new Date().toISOString());
    </script>
    <script src="js/tiles.js?nocache=2026011920"></script>
    <script src="js/level.js?nocache=2026011920"></script>
    <script src="js/player.js?nocache=2026011920"></script>
    <script src="js/tile_editor.js?nocache=2026011920"></script>
    <script src="js/game.js?nocache=2026011920"></script>
</body>
</html>
