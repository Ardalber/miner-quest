<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Debug - Miner Quest</title>
    <style>
        body {
            background: #1a1a1a;
            color: #fff;
            font-family: monospace;
            padding: 20px;
            margin: 0;
        }
        #log {
            background: #0a0a0a;
            border: 1px solid #667eea;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            max-height: 500px;
            overflow-y: auto;
            font-size: 12px;
        }
        .error { color: #ff6b6b; }
        .success { color: #51cf66; }
        .warning { color: #ffd43b; }
        .info { color: #74c0fc; }
        h1 { color: #667eea; margin-top: 0; }
        button {
            background: #667eea;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #5568d3;
        }
    </style>
</head>
<body>
    <h1>üîç Debug Miner Quest</h1>
    <div id="log"></div>
    <button onclick="testLoadGame()">Test Chargement</button>
    <button onclick="testDOM()">Test DOM</button>
    <button onclick="testScripts()">Test Scripts</button>
    <button onclick="clearLog()">Effacer</button>
    <button onclick="loadActualGame()">Charger le jeu</button>

    <script>
        const logEl = document.getElementById('log');

        function log(msg, type = 'info') {
            const span = document.createElement('div');
            span.className = type;
            span.textContent = `[${new Date().toLocaleTimeString()}] ${msg}`;
            logEl.appendChild(span);
            logEl.scrollTop = logEl.scrollHeight;
        }

        function clearLog() {
            logEl.innerHTML = '';
        }

        window.addEventListener('error', (e) => {
            log(`‚ùå ERROR: ${e.message} at ${e.filename}:${e.lineno}`, 'error');
        });

        window.addEventListener('unhandledrejection', (e) => {
            log(`‚ùå PROMISE REJECTION: ${e.reason}`, 'error');
        });

        function testDOM() {
            log('V√©rification du DOM...', 'info');
            
            const elements = [
                'modal-name',
                'player-name-input',
                'btn-start-game',
                'gameCanvas',
                'btn-commands',
                'btn-editor',
                'btn-tiles'
            ];

            elements.forEach(id => {
                const el = document.getElementById(id);
                if (el) {
                    log(`‚úÖ #${id} existe`, 'success');
                } else {
                    log(`‚ùå #${id} MANQUANT`, 'error');
                }
            });

            // V√©rifier les CSS
            const styles = document.querySelectorAll('link[rel="stylesheet"]');
            log(`Feuilles CSS charg√©es: ${styles.length}`, 'info');
            styles.forEach(link => {
                log(`  - ${link.href}`, 'info');
            });
        }

        function testScripts() {
            log('V√©rification des scripts globaux...', 'info');

            const globals = [
                'TileConfig',
                'TileRenderer',
                'tileRenderer',
                'LevelManager',
                'levelManager',
                'Player'
            ];

            globals.forEach(name => {
                if (typeof window[name] !== 'undefined') {
                    log(`‚úÖ ${name} charg√©`, 'success');
                } else {
                    log(`‚ùå ${name} MANQUANT`, 'error');
                }
            });

            // V√©rifier les fonctions
            const functions = [
                'showNameModal',
                'init',
                'gameLoop'
            ];

            functions.forEach(name => {
                if (typeof window[name] === 'function') {
                    log(`‚úÖ ${name}() existe`, 'success');
                } else {
                    log(`‚ùå ${name}() MANQUANT`, 'error');
                }
            });
        }

        function testLoadGame() {
            log('Test chargement du jeu...', 'info');
            
            try {
                testDOM();
                testScripts();
                
                // Essayer de charger les niveaux
                if (typeof levelManager !== 'undefined') {
                    log('Chargement des niveaux...', 'info');
                    levelManager.loadLevelsFromStorage().then(foundLevels => {
                        if (foundLevels) {
                            log('‚úÖ Niveaux charg√©s avec succ√®s', 'success');
                            const levels = levelManager.getLevelList();
                            log(`Niveaux trouv√©s: ${levels.join(', ')}`, 'info');
                        } else {
                            log('‚ö†Ô∏è Aucun niveau trouv√©', 'warning');
                        }
                    }).catch(err => {
                        log(`‚ùå Erreur chargement niveaux: ${err.message}`, 'error');
                    });
                }
            } catch (e) {
                log(`‚ùå Exception: ${e.message}`, 'error');
            }
        }

        function loadActualGame() {
            window.location.href = 'index.html';
        }

        // Ex√©cuter les tests au chargement
        window.addEventListener('DOMContentLoaded', () => {
            log('Page charg√©e!', 'success');
        });
    </script>

    <!-- Charger les m√™mes scripts que index.html -->
    <script src="js/tiles.js"></script>
    <script src="js/level.js"></script>
    <script src="js/player.js"></script>
    <script src="js/tile_editor.js"></script>
    <script src="js/game.js"></script>
</body>
</html>
